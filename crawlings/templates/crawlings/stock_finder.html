{% extends "base.html" %}
{% load custom_filters %}

{% block content %}
<div class="container mt-5">

  <!-- ğŸ” í—¤ë” -->
  <header class="text-center mb-5 p-4 rounded bg-gradient" style="background: linear-gradient(to right, #e3f2fd, #bbdefb);">
    <h5 class="text-muted">ğŸ“ˆ ì£¼ì‹, íˆ¬ììë“¤ì€ ì–´ë–»ê²Œ ë§í• ê¹Œìš”?</h5>
    <h1 class="fw-bold display-5 mb-3">
      {% if company_name %}
        <span class="text-primary">{{ company_name }}</span> ì£¼ì‹ ëŒ“ê¸€ ì‚´í´ë³´ê¸°
      {% else %}
        ì£¼ì‹ ëŒ“ê¸€ ì‚´í´ë³´ê¸°
      {% endif %}
    </h1>
    <hr class="w-50 mx-auto border-2 border-primary">
  </header>

  <!-- ğŸ¢ íšŒì‚¬ ê²€ìƒ‰ í¼ -->
  <div class="card shadow-sm p-4 mb-5">
    <form class="row g-3 align-items-end" action="{% url 'crawlings:index' %}" method="post">
      {% csrf_token %}
      <div class="col-md-9">
        <label for="company_name" class="form-label">íšŒì‚¬ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”</label>
        <input type="text" id="company_name" name="company_name" class="form-control form-control-lg"
               placeholder="ì˜ˆ: ì‚¼ì„±ì „ì" value="{{ company_name }}">
      </div>
      <div class="col-md-3 text-end">
        <button type="submit" class="btn btn-primary btn-lg w-100">ğŸ” ê²€ìƒ‰</button>
      </div>
    </form>
  </div>

  <!-- ğŸ“Š ëŒ“ê¸€ ìš”ì•½ -->
  <div class="container">
    {% if analysis %}
    <div class="analysis-container mb-5">
      <h4 class="fw-bold text-dark mb-3"><span class="text-primary">{{ company_name }}</span> ëŒ“ê¸€ ìš”ì•½</h4>
      <div class="card shadow-sm border-0 rounded-4 bg-light">
        <div class="card-body">

          <h5 class="card-title fs-5 mb-3">ì „ì²´ ì—¬ë¡ :
            {% if "ì „ì²´ ì—¬ë¡ : ë¶€ì •" in analysis.analysis_result %}
              <span class="text-danger fw-bold">ë¶€ì • âŒ</span>
            {% elif "ì „ì²´ ì—¬ë¡ : ê¸ì •" in analysis.analysis_result %}
              <span class="text-success fw-bold">ê¸ì • âœ…</span>
            {% else %}
              <span class="text-secondary fw-bold">ì¤‘ë¦½ ğŸ¤”</span>
            {% endif %}
          </h5>

          <!-- âœ… ê¸ì • í‚¤ì›Œë“œ -->
          <p class="card-text mb-2"><b class="text-success">âœ… ê¸ì • í‚¤ì›Œë“œ:</b>
            {% for keyword in analysis.analysis_result|stringformat:'s'|split:'ê¸ì •ì  í‚¤ì›Œë“œ:'|last|split:'ë¶€ì •ì  í‚¤ì›Œë“œ:'|first|split:',' %}
              <span class="badge bg-success fs-5 px-3 py-2 rounded-pill me-2">
                {{ keyword|trim|cut:"."|cut:"0"|cut:"1"|cut:"2"|cut:"3"|cut:"4"|cut:"5"|cut:"6"|cut:"7"|cut:"8"|cut:"9" }}
              </span>
            {% endfor %}
          </p>

          <!-- ğŸš« ë¶€ì • í‚¤ì›Œë“œ -->
          <p class="card-text"><b class="text-danger">âŒ ë¶€ì • í‚¤ì›Œë“œ:</b>
            {% for keyword in analysis.analysis_result|stringformat:'s'|split:'ë¶€ì •ì  í‚¤ì›Œë“œ:'|last|split:'ì¢…í•© ë¶„ì„ ìš”ì•½:'|first|split:',' %}
              <span class="badge bg-danger fs-5 px-3 py-2 rounded-pill me-2">
                {{ keyword|trim|cut:"."|cut:"0"|cut:"1"|cut:"2"|cut:"3"|cut:"4"|cut:"5"|cut:"6"|cut:"7"|cut:"8"|cut:"9" }}
              </span>
            {% endfor %}
          </p>

        </div>
      </div>
    </div>
    {% endif %}
  </div>

  <!-- ğŸ’¬ ëŒ“ê¸€ ìƒì„¸ -->
  <div class="mt-5">
    <h4 class="fw-bold fs-3 mb-4">ğŸ’¬ ëŒ“ê¸€ ìƒì„¸</h4>
    <div class="container">
      {% if comments %}
        <div class="d-flex flex-column gap-4">
          {% for comment in comments %}
            <div class="bg-white p-4 rounded-4 shadow-sm border-start border-5 border-primary-subtle">

              <!-- ğŸ—£ï¸ í…ìŠ¤íŠ¸ + ì•„ì´ì½˜ -->
              <div class="d-flex align-items-start gap-3">
                <span class="fs-3">ğŸ—£ï¸</span>
                <p class="mb-0 fs-5 text-dark" style="white-space: pre-line;">{{ comment.comment }}</p>
              </div>

              <!-- ì‚­ì œ ë²„íŠ¼ì„ ì•„ë˜ìª½ìœ¼ë¡œ! -->
              <div class="text-end mt-3">
                <form action="{% url "crawlings:delete_comment" comment.pk %}" method="post">
                  {% csrf_token %}
                  <input class="btn btn-outline-danger btn-sm fw-bold px-3 py-1" type="submit" value="ì‚­ì œ">
                </form>
              </div>

            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-muted fs-5">ì•„ì§ ë“±ë¡ëœ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
      {% endif %}
    </div>
  </div>

</div>
{% endblock content %}
